syntax = "proto3";

package alpaca.marketdata.v2;

import "buf/validate/validate.proto";
import "sebuf/http/annotations.proto";

// OptionBar represents an option OHLCV bar.
message OptionBar {
  // Timestamp (RFC 3339).
  string t = 1 [(sebuf.http.field_examples) = { values: ["2024-01-15T09:30:00Z"] }];

  // Open price.
  double o = 2 [(sebuf.http.field_examples) = { values: ["5.25"] }];

  // High price.
  double h = 3 [(sebuf.http.field_examples) = { values: ["5.50"] }];

  // Low price.
  double l = 4 [(sebuf.http.field_examples) = { values: ["5.00"] }];

  // Close price.
  double c = 5 [(sebuf.http.field_examples) = { values: ["5.40"] }];

  // Volume.
  int64 v = 6 [(sebuf.http.field_examples) = { values: ["1234"] }];

  // Number of trades.
  int64 n = 7 [(sebuf.http.field_examples) = { values: ["56"] }];

  // Volume weighted average price.
  double vw = 8 [(sebuf.http.field_examples) = { values: ["5.35"] }];
}

// GetOptionBarsRequest is the request to get historical option bars.
message GetOptionBarsRequest {
  // Comma-separated list of option symbols (OCC format).
  string symbols = 1 [
    (buf.validate.field).required = true,
    (sebuf.http.query) = { name: "symbols" },
    (sebuf.http.field_examples) = { values: ["AAPL240119C00150000,AAPL240119P00145000"] }
  ];

  // Bar timeframe.
  string timeframe = 2 [
    (buf.validate.field).required = true,
    (sebuf.http.query) = { name: "timeframe" },
    (sebuf.http.field_examples) = { values: ["1Day"] }
  ];

  // Start timestamp (RFC 3339 or YYYY-MM-DD).
  string start = 3 [
    (sebuf.http.query) = { name: "start" },
    (sebuf.http.field_examples) = { values: ["2024-01-01"] }
  ];

  // End timestamp (RFC 3339 or YYYY-MM-DD).
  string end = 4 [
    (sebuf.http.query) = { name: "end" },
    (sebuf.http.field_examples) = { values: ["2024-01-31"] }
  ];

  // Maximum number of bars to return (1-10000, default 1000).
  int32 limit = 5 [
    (sebuf.http.query) = { name: "limit" },
    (buf.validate.field).int32 = { gte: 1, lte: 10000 },
    (sebuf.http.field_examples) = { values: ["1000"] }
  ];

  // Page token for pagination.
  string page_token = 6 [
    (sebuf.http.query) = { name: "page_token" },
    (sebuf.http.field_examples) = { values: ["token123"] }
  ];

  // Sort order (asc, desc).
  string sort = 7 [
    (sebuf.http.query) = { name: "sort" },
    (sebuf.http.field_examples) = { values: ["asc"] }
  ];
}

// OptionBarsList is a list of bars for a single option symbol.
message OptionBarsList {
  repeated OptionBar bars = 1;
}

// GetOptionBarsResponse is the response containing option bars.
message GetOptionBarsResponse {
  // Map of symbol to bars.
  map<string, OptionBarsList> bars = 1;

  // Next page token.
  string next_page_token = 2 [(sebuf.http.field_examples) = { values: ["YWJjZGVm"] }];
}

// GetLatestOptionBarsRequest is the request to get the latest option bars.
message GetLatestOptionBarsRequest {
  // Comma-separated list of option symbols.
  string symbols = 1 [
    (buf.validate.field).required = true,
    (sebuf.http.query) = { name: "symbols" },
    (sebuf.http.field_examples) = { values: ["AAPL240119C00150000"] }
  ];

  // Data feed (indicative, opra).
  string feed = 2 [
    (sebuf.http.query) = { name: "feed" },
    (sebuf.http.field_examples) = { values: ["opra"] }
  ];
}

// GetLatestOptionBarsResponse is the response containing the latest option bars.
message GetLatestOptionBarsResponse {
  // Map of symbol to latest bar.
  map<string, OptionBar> bars = 1;
}
