syntax = "proto3";

package alpaca.marketdata.v2;

import "buf/validate/validate.proto";
import "sebuf/http/annotations.proto";

// OptionQuote represents an option bid/ask quote.
message OptionQuote {
  // Timestamp (RFC 3339).
  string t = 1 [(sebuf.http.field_examples) = { values: ["2024-01-15T10:30:00.123456Z"] }];

  // Ask exchange code.
  string ax = 2 [(sebuf.http.field_examples) = { values: ["C"] }];

  // Ask price.
  double ap = 3 [(sebuf.http.field_examples) = { values: ["5.30"] }];

  // Ask size.
  int64 as = 4 [(sebuf.http.field_examples) = { values: ["50"] }];

  // Bid exchange code.
  string bx = 5 [(sebuf.http.field_examples) = { values: ["P"] }];

  // Bid price.
  double bp = 6 [(sebuf.http.field_examples) = { values: ["5.20"] }];

  // Bid size.
  int64 bs = 7 [(sebuf.http.field_examples) = { values: ["30"] }];

  // Quote condition.
  string c = 8 [(sebuf.http.field_examples) = { values: ["R"] }];
}

// GetOptionQuotesRequest is the request to get historical option quotes.
message GetOptionQuotesRequest {
  // Comma-separated list of option symbols.
  string symbols = 1 [
    (buf.validate.field).required = true,
    (sebuf.http.query) = { name: "symbols" },
    (sebuf.http.field_examples) = { values: ["AAPL240119C00150000"] }
  ];

  // Start timestamp (RFC 3339 or YYYY-MM-DD).
  string start = 2 [
    (sebuf.http.query) = { name: "start" },
    (sebuf.http.field_examples) = { values: ["2024-01-15T09:30:00Z"] }
  ];

  // End timestamp (RFC 3339 or YYYY-MM-DD).
  string end = 3 [
    (sebuf.http.query) = { name: "end" },
    (sebuf.http.field_examples) = { values: ["2024-01-15T16:00:00Z"] }
  ];

  // Maximum number of quotes to return (1-10000, default 1000).
  int32 limit = 4 [
    (sebuf.http.query) = { name: "limit" },
    (buf.validate.field).int32 = { gte: 1, lte: 10000 },
    (sebuf.http.field_examples) = { values: ["1000"] }
  ];

  // Page token for pagination.
  string page_token = 5 [
    (sebuf.http.query) = { name: "page_token" },
    (sebuf.http.field_examples) = { values: ["token123"] }
  ];

  // Sort order (asc, desc).
  string sort = 6 [
    (sebuf.http.query) = { name: "sort" },
    (sebuf.http.field_examples) = { values: ["asc"] }
  ];
}

// OptionQuotesList is a list of quotes for a single option symbol.
message OptionQuotesList {
  repeated OptionQuote quotes = 1;
}

// GetOptionQuotesResponse is the response containing option quotes.
message GetOptionQuotesResponse {
  // Map of symbol to quotes.
  map<string, OptionQuotesList> quotes = 1;

  // Next page token.
  string next_page_token = 2 [(sebuf.http.field_examples) = { values: ["YWJjZGVm"] }];
}

// GetLatestOptionQuotesRequest is the request to get the latest option quotes.
message GetLatestOptionQuotesRequest {
  // Comma-separated list of option symbols.
  string symbols = 1 [
    (buf.validate.field).required = true,
    (sebuf.http.query) = { name: "symbols" },
    (sebuf.http.field_examples) = { values: ["AAPL240119C00150000"] }
  ];

  // Data feed (indicative, opra).
  string feed = 2 [
    (sebuf.http.query) = { name: "feed" },
    (sebuf.http.field_examples) = { values: ["opra"] }
  ];
}

// GetLatestOptionQuotesResponse is the response containing the latest option quotes.
message GetLatestOptionQuotesResponse {
  // Map of symbol to latest quote.
  map<string, OptionQuote> quotes = 1;
}
